<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Enphase Solar System</title>
    <link data-th-href="@{/webjars/bulma/0.7.2/css/bulma.css}" rel="stylesheet"/>
    <link rel="stylesheet" data-th-href="@{/webjars/font-awesome/4.7.0/css/font-awesome.min.css}"/>
    <script type="text/javascript" data-th-src="@{/webjars/highcharts/7.0.3/highcharts.js}"></script>
    <script type="text/javascript" data-th-src="@{/webjars/highcharts/7.0.3/highcharts-more.js}"></script>
</head>
<body>
<section class="hero is-info">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
                Enphase Collector
            </h1>
            <h2 class="subtitle">
                <i class="fa fa-copyright"></i> David McPaul 2018
            </h2>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
        <div class="columns">
            <div id="consumption" class="column is-4"></div>
            <div class="column"></div>
            <div id="production" class="column is-4"></div>
        </div>
    </div>
</section>
<section class="section has-background-light">
    <div class="content has-text-centered">
        <p>Rendered by <strong>Thymeleaf</strong> at <span data-th-text="${#calendars.format(#execInfo.now, 'dd-MMM-yyyy HH:mm')}"></span><br>
            Envoy Software Version: <span data-th-text="${software_version}">version</span><br>
            Envoy Serial Number: <span data-th-text="${serial_number}">serial</span><br></p>
    </div>
</section>
<script data-th-inline="javascript">
    var value = [[${consumption}]];

    var consumption_chart = new Highcharts.chart({
        chart: {
            renderTo: 'consumption',
            type: 'gauge',
            height: '100%'
        },
        title: {
            text: 'Current Consumption'
        },
        pane: {
            startAngle: -150,
            endAngle: 150,
            background: [{
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#FFF'],
                        [1, '#333']
                    ]
                },
                borderWidth: 0,
                outerRadius: '109%'
            }, {
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#333'],
                        [1, '#FFF']
                    ]
                },
                borderWidth: 1,
                outerRadius: '107%'
            }, {
                // default background
            }, {
                backgroundColor: '#DDD',
                borderWidth: 0,
                outerRadius: '105%',
                innerRadius: '103%'
            }]
        },
        yAxis: {
            min: 0,
            max: 6000,

            minorTickInterval: 'auto',
            minorTickWidth: 1,
            minorTickLength: 10,
            minorTickPosition: 'inside',
            minorTickColor: '#666',

            tickPixelInterval: 30,
            tickWidth: 2,
            tickPosition: 'inside',
            tickLength: 10,
            tickColor: '#666',
            labels: {
                step: 2,
                rotation: 'auto'
            },
            title: {
                text: 'W'
            },
            plotBands: [{
                from: 0,
                to: 1500,
                color: '#55BF3B' // green
            }, {
                from: 1500,
                to: 3000,
                color: '#DDDF0D' // yellow
            }, {
                from: 3000,
                to: 6000,
                color: '#DF5353' // red
            }]
        },
        series: [{
            name: 'consumption',
            data: [ value ],
            tooltip: {
                valueSuffix: ' W'
            }
        }]
    });

    function refresh_consumption(chart, url) {

        var xhttp;
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var point = chart.series[0].points[0];
                point.update(Number(xhttp.responseText));
            }
        };
        xhttp.open("GET", url, true);
        xhttp.send();
    }

    var consumptionUrl = [[${#httpServletRequest.contextPath}]] + '/consumption';
    setInterval("refresh_consumption(consumption_chart, consumptionUrl)", [[${refresh_interval}]]);
</script>
<script data-th-inline="javascript">
    var value = [[${production}]];

    var production_chart = new Highcharts.chart({
        chart: {
            renderTo: 'production',
            type: 'gauge',
            height: '100%'
        },
        title: {
            text: 'Current Production'
        },
        pane: {
            startAngle: -150,
            endAngle: 150,
            background: [{
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#FFF'],
                        [1, '#333']
                    ]
                },
                borderWidth: 0,
                outerRadius: '109%'
            }, {
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#333'],
                        [1, '#FFF']
                    ]
                },
                borderWidth: 1,
                outerRadius: '107%'
            }, {
                // default background
            }, {
                backgroundColor: '#DDD',
                borderWidth: 0,
                outerRadius: '105%',
                innerRadius: '103%'
            }]
        },
        yAxis: {
            min: 0,
            max: 5000,

            minorTickInterval: 'auto',
            minorTickWidth: 1,
            minorTickLength: 10,
            minorTickPosition: 'inside',
            minorTickColor: '#666',

            tickPixelInterval: 30,
            tickWidth: 2,
            tickPosition: 'inside',
            tickLength: 10,
            tickColor: '#666',
            labels: {
                step: 2,
                rotation: 'auto'
            },
            title: {
                text: 'W'
            },
            plotBands: [{
                from: 0,
                to: 1000,
                color: '#DF5353' // red
            }, {
                from: 1000,
                to: 2000,
                color: '#DDDF0D' // yellow
            }, {
                from: 2000,
                to: 5000,
                color: '#55BF3B' // green
            }]
        },
        series: [{
            name: 'production',
            data: [ value ],
            tooltip: {
                valueSuffix: ' W'
            }
        }]
    });

    function refresh_production(chart, url) {
        var xhttp;
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var point = chart.series[0].points[0];
                point.update(Number(xhttp.responseText));
            }
        };
        xhttp.open("GET", url, true);
        xhttp.send();
    }

    var productionUrl = [[${#httpServletRequest.contextPath}]] + '/production';
    setInterval("refresh_production(production_chart, productionUrl)", [[${refresh_interval}]]);

</script>
<!--<script data-th-inline="javascript">
    function refreshXXX() {
        var token = $('input[name="_csrf"]').val();
        var fullUrl = [[${#httpServletRequest.contextPath}]] + '/refresh';
        $.ajax({
            type: "post",
            headers: {
                'X-CSRF-TOKEN': token
            },
            url: fullUrl,
            cache: false,
            data: {reference: rowid},
            success: function (response) {
                $( "#jobListBlock").html(response);
            },
            error: function (xhr, ajaxOptions, thrownError) { //Add these parameters to display the required response
                alert(xhr.status);
                alert(xhr.responseText);
            }
        });
    }
</script>
<script data-th-inline="javascript">

    var rawSamples = /*[[${metrics}]]*/ {};
    var data = rawSamples.map(function (s) {
        return [s.time, s.panel, s.value]
    });

    var chart = new Highcharts.chart('chart', {

        chart: {
            type: 'heatmap',
            marginTop: 40,
            marginBottom: 80,
            plotBorderWidth: 1
        },
        title: {
            text: 'Solar Panel Performance over today'
        },
        xAxis: {
            categories: ['0000', '0100', '0200', '0300', '0400', '0500', '0600', '0700', '0800', '0900', '1000', '1100', '1200', '1300', '1400', '1500', '1600', '1700', '1800', '1900', '2000', '2100', '2200', '2300', '2400', ]
        },
        yAxis: {
            categories: ['Panel 1', 'Panel 2', 'Panel 3', 'Panel 4', 'Panel 5', 'Panel 6', 'Panel 7', 'Panel 8', 'Panel 9', 'Panel 10', 'Panel 11', 'Panel 12', 'Panel 13', 'Panel 14', 'Panel 15', 'Panel 16'],
            title: null
        },
        colorAxis: {
            stops: [
                [0, '#0000aa'],
                [0.25, '#004488'],
                [0.5, '#008844'],
                [0.75, '#00cc22'],
                [1, '#00ff00']
            ],
            min: 0,
            max: 300,
            startOnTick: false,
            endOnTick: false,
            labels: {
                format: '{value}W'
            }
        },
        legend: {
            align: 'right',
            layout: 'vertical',
            margin: 0,
            verticalAlign: 'top',
            y: 25,
            symbolHeight: 280
        },
        series: [{
            name: 'Watts per Panel',
            borderWidth: 1,
            data: data,
            dataLabels: {
                enabled: true,
                color: '#000000'
            }
        }]

    });
</script>
<script data-th-inline="javascript">

    var data = [ [0,0,0],[0,1,100],[0,2,150],[1,0,50],[1,1,200],[1,2,200],[2,0,100],[2,1,300],[2,2,350] ];

    var chart = new Highcharts.chart('test', {

        chart: {
            type: 'heatmap',
            marginTop: 40,
            marginBottom: 80,
            plotBorderWidth: 1
        },
        title: {
            text: 'Solar Panel Performance over today'
        },
        xAxis: {
            categories: ['1', '2', '3']
        },

        yAxis: {
            categories: ['A', 'B', 'C'],
            title: null
        },
        colorAxis: {
            min: 0,
            max: 320,
            minColor: '#FFFFFF',
            maxColor: Highcharts.getOptions().colors[0],
            startOnTick: false,
            endOnTick: false,
            labels: {
                format: '{value}W'
            }
        },
        legend: {
            align: 'right',
            layout: 'vertical',
            margin: 0,
            verticalAlign: 'top',
            y: 25,
            symbolHeight: 280
        },
        series: [{
            name: 'Watts per Panel',
            borderWidth: 1,
            data: data,
            dataLabels: {
                enabled: true,
                color: '#000000'
            }
        }]

    });
</script>-->
</body>
</html>